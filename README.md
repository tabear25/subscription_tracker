# これは何（What's this?）

Notionで管理しているサブスクリプション（定額課金サービス）の支払い情報を取得し、**Googleカレンダーへのリマインド通知**と**次回支払日の自動更新**を行うGoogle Apps Script (GAS) 製のツールです。

# 機能（Features）

* **事前通知**: 支払日の指定日前（デフォルトは7日前）に、Googleカレンダーに予定として通知を作成します。
* **日付の自動更新**: 支払日が過ぎると、支払サイクル（月払い/年払い）に合わせてNotion上の「次回支払日」を自動で書き換えます。
* **ステータス管理**: ステータスが `Active` なものだけを監視し、解約済みサービスの通知は行いません。

# 前提条件（Prerequisites）

* Googleアカウント（Google Apps ScriptとGoogleカレンダーを使用します）
* Notionアカウント

## 必要な環境（Required Environment）

* Google Apps Script (ブラウザ上で動作するため、ローカルへの環境構築は不要です)

# 使い方（How to Use）

### 1. 準備（Preparation）

1. **Notionでデータベース（=DB）を作成する**
* Notion上でサブスク管理用のDBを作成（または既存DBを使用）してください。
* **プロパティ名（列名）と種類**は以下の通りに設定してください。
* ※コード内の定数を変更すればカスタマイズ可能ですが、デフォルトはこの設定です。


| プロパティ名 | 種類 (Type) | 備考 |
| --- | --- | --- |
| Name | Title | サービス名 |
| 更新日 | Date | 次回の支払日 |
| 料金 | Number | 金額 |
| Billing | Select | `Monthly`, `Yearly`, `2 years` のいずれかを選択 |
| Status | Select | `Active` (契約中) を選択 |

2. **Notion API（無料）を取得する**
* [Notion My Integrations](https://www.notion.so/my-integrations)から新しいインテグレーションを作成し、`Internal Integration Secret`（トークン）を控えてください。
* 作成したインテグレーションを、1で作成したNotionデータベースのページに追加（コネクト）してください。

3. **DBID（無料）を取得する**
* 1で作成したDBのID（=DBID）を取得します。
* DBをフルページで開いた際のURLの以下の部分です。


```
https://www.notion.so/<データベースID>?v=<ビューID>

```

### 2. スクリプトの設置（Setup Script）

1. [Google Apps Script](https://script.google.com/) にアクセスし、「新しいプロジェクト」を作成します。
2. エディタに本リポジトリのコード（`main.js`等の内容）をコピペします。

### 3. 環境変数の設定（Environment Variables）

コードに直接APIキーを書かないよう、GASの「スクリプトプロパティ」機能を使用します。

1. GASエディタの左メニュー「⚙️（プロジェクトの設定）」を開きます。
2. 最下部の「スクリプト プロパティ」に以下を追加してください。
| プロパティ (Key) | 値 (Value) |
| --- | --- |
| `NOTION_TOKEN` | 手順1-2で取得したトークン |
| `DATABASE_ID` | 手順1-3で取得したDBID |

### 4. トリガーの設定（Set Trigger）

毎日自動でチェックするために、トリガーを設定します。

1. GASエディタの左メニュー「⏰（トリガー）」を開きます。
2. 右下の「トリガーを追加」をクリックし、以下のように設定します。
* **実行する関数**: `main`
* **イベントのソース**: `時間主導型`
* **タイプ**: `日付ベースのタイマー`
* **時刻**: `午前 8時 〜 9時` （通知を受け取りたい時間帯なので任意）



### 注意点（Notes）

* **初回データの入力**: 導入時、Notionの「更新日」には**正確な次回支払日**を入力してください。ここが間違っていると通知もズレます。
* **解約時の運用**: サブスクを解約した場合は、Notionの `Status` を `Active` 以外（例: `Canceled`）に変更するか、日付を空欄にしてください。
* **通知タイミング**: デフォルトでは「7日前」にGoogleカレンダーに登録されます。変更したい場合はコード内の `NOTIFY_DAYS_BEFORE` の数値を変更してください。